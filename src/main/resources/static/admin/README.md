# Админ-панель Sticker Art Gallery

## Описание
Простая web-панель для администрирования проекта Sticker Art Gallery. Предоставляет интерфейс для управления пользователями и стикерсетами.

## Доступ к панели

### URL
```
http://localhost:8080/admin/
```

### Авторизация
Админ-панель использует авторизацию через Telegram initData. Доступна только пользователям с ролью ADMIN.

Два способа входа:
1. **Через Telegram Mini App**: Автоматическое получение initData
2. **Ручной ввод**: Вставка initData в поле на странице авторизации

## Функционал

### Управление пользователями (`/admin/`)
- **Просмотр**: Список всех пользователей с пагинацией
- **Фильтрация**:
  - По роли (USER/ADMIN)
  - По статусу блокировки
  - По статусу подписки
  - По диапазону баланса ART
  - По дате регистрации
  - Поиск по User ID
- **Редактирование**:
  - Изменение роли
  - Изменение баланса ART
  - Изменение статуса блокировки
  - Изменение статуса подписки
- **Массовые операции**:
  - Блокировка выбранных пользователей
  - Разблокировка выбранных пользователей

### Управление стикерсетами (`/admin/stickers.html`)
- **Просмотр**: Список всех стикерсетов с пагинацией
- **Фильтрация**:
  - По типу (USER/OFFICIAL)
  - По видимости (PUBLIC/PRIVATE)
  - По владельцу (userId)
  - Поиск по названию
- **Действия**:
  - Блокировка/разблокировка стикерсета
  - Удаление стикерсета (soft delete)
- **Массовые операции**:
  - Блокировка выбранных стикерсетов
  - Разблокировка выбранных стикерсетов
  - Удаление выбранных стикерсетов
  - Установка официального статуса

## Технические детали

### Backend API
- `GET /api/users` - получение списка пользователей (только ADMIN)
- `GET /api/users/{id}` - получение пользователя по ID
- `PATCH /api/profiles/{userId}` - обновление профиля (только ADMIN)
- `GET /api/stickersets` - получение списка стикерсетов
- `PUT /api/stickersets/{id}/block` - блокировка стикерсета
- `PUT /api/stickersets/{id}/unblock` - разблокировка стикерсета
- `DELETE /api/stickersets/{id}` - удаление стикерсета
- `PUT /api/stickersets/{id}/official` - установка официального статуса
- `DELETE /api/stickersets/{id}/official` - снятие официального статуса

### Frontend
- **Технологии**: Vanilla JavaScript + Tailwind CSS
- **Архитектура**: 
  - Компонентный подход (таблицы, фильтры)
  - API client для работы с backend
  - Переиспользуемые утилиты
- **Хранение**: localStorage для initData и настроек

### Безопасность
- Все admin эндпоинты защищены `@PreAuthorize("hasRole('ADMIN')")`
- InitData валидируется на каждом запросе
- При 401 ошибке автоматический редирект на страницу авторизации
- При 403 ошибке показывается уведомление о недостаточных правах

## Структура файлов
```
/admin/
├── index.html              # Страница пользователей
├── stickers.html           # Страница стикерсетов
├── login.html              # Страница авторизации
├── css/
│   └── admin.css           # Дополнительные стили
└── js/
    ├── api.js              # API client
    ├── auth.js             # Логика авторизации
    ├── utils.js            # Утилиты
    ├── table.js            # Компонент таблицы
    ├── filters.js          # Компонент фильтров
    ├── users.js            # Логика страницы пользователей
    └── stickers.js         # Логика страницы стикерсетов
```

## Примеры использования

### Создание администратора
Для предоставления прав администратора выполните SQL запрос:
```sql
UPDATE user_profiles 
SET role = 'ADMIN' 
WHERE user_id = <telegram_id>;
```

### Получение initData
1. Откройте Telegram Web App
2. В консоли браузера выполните: `window.Telegram.WebApp.initData`
3. Скопируйте значение и используйте для входа

## Особенности реализации

### Пагинация
- 20 элементов на страницу по умолчанию
- Навигация по страницам с визуальным индикатором текущей страницы

### Фильтры
- Применяются по нажатию кнопки "Применить"
- Сброс всех фильтров кнопкой "Сбросить"
- Enter в текстовых полях применяет фильтры

### Поиск
- Debounce 500ms для оптимизации запросов
- Real-time поиск по мере ввода

### Массовые операции
- Выбор через чекбоксы
- "Select all" для выбора всех на странице
- Панель действий появляется при выборе элементов

## Разработка

### Запуск приложения
```bash
./gradlew bootRun --args='--spring.profiles.active=dev'
```

### Доступ к админ-панели
```
http://localhost:8080/admin/login.html
```

## Поддержка
При возникновении проблем проверьте:
1. Наличие роли ADMIN у пользователя
2. Валидность initData (не старше 1 минуты)
3. Логи приложения для ошибок авторизации
4. Консоль браузера для ошибок JavaScript
