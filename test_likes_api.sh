#!/bin/bash

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API –ª–∞–π–∫–æ–≤
BASE_URL="http://localhost:8080"
STICKER_SET_ID=22

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ª–∞–π–∫–æ–≤"
echo "=========================="

# 1. –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
curl -s "$BASE_URL/api/stickersets?size=1" > /dev/null
if [ $? -eq 0 ]; then
    echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ"
else
    echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"
    exit 1
fi

# 2. –ü—Ä–æ–≤–µ—Ä–∏–º —Ç–æ–ø —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–æ–≤ –ø–æ –ª–∞–π–∫–∞–º
echo "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ø–∞ —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–æ–≤ –ø–æ –ª–∞–π–∫–∞–º..."
curl -s "$BASE_URL/api/likes/top-stickersets?size=1" | jq -r '.content[0].stickerSet.title'
if [ $? -eq 0 ]; then
    echo "‚úÖ –¢–æ–ø —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå –¢–æ–ø —Å—Ç–∏–∫–µ—Ä—Å–µ—Ç–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi

# 3. –ü–æ–ø—Ä–æ–±—É–µ–º –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401)
echo "3. –¢–µ—Å—Ç –ª–∞–π–∫–∞ –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏..."
RESPONSE=$(curl -s -w "%{http_code}" -X PUT "$BASE_URL/api/likes/stickersets/$STICKER_SET_ID/toggle")
HTTP_CODE="${RESPONSE: -3}"
if [ "$HTTP_CODE" = "401" ]; then
    echo "‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è (–æ–∂–∏–¥–∞–µ–º–æ)"
elif [ "$HTTP_CODE" = "500" ]; then
    echo "‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω–∞ 500 –æ—à–∏–±–∫–∞ (–ø—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)"
else
    echo "‚ö†Ô∏è  –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞: $HTTP_CODE"
fi

# 4. –ü–æ–ø—Ä–æ–±—É–µ–º —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
echo "4. –¢–µ—Å—Ç —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏..."
RESPONSE=$(curl -s -w "%{http_code}" -X PUT "$BASE_URL/api/likes/stickersets/$STICKER_SET_ID/toggle" \
  -H "X-Telegram-Init-Data: test")
HTTP_CODE="${RESPONSE: -3}"
echo "–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞: $HTTP_CODE"

echo "=========================="
echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
